# Development Context (Integrated)

## 1. Current Goals (현재 목표)

### A. 도메인/엔티티 인프라

* [ ] **ERD 기반 키/제약 수기 확정**

    * PK/FK
    * Unique / Index
    * Cascade / Nullable 정책
* [ ] **신규 엔티티 인프라 준비**

    * 패키지 구조 확정
    * BaseEntity / Auditing 전략 정리
* [ ] **기본 스캐폴딩**

    * Repository / Test 기본 골격

### B. 인증/보안 (JWT Phase 2) [COMPLETED]

* [x] **비밀번호 만료 정책 (90일)**
* [x] **로그아웃 / 전체 로그아웃**
* [x] **Access Token 블랙리스트**
* [x] **Refresh Token Rotation + 동시성 제어**
* [x] **refresh_tokens 테이블**

---

## 2. Recent Changes (최근 변경 사항)

### 2026-02-10

* `chore(db)` companies 이름 검색 FULLTEXT 인덱스 멱등 Flyway(V25) 분리 적용(MySQL) 및 H2 no-op V25 추가
* `fix(company)` 기업 검색에 FULLTEXT 우선 + 실패/0건 시 LIKE fallback 하이브리드 로직 적용, `stock_code IS NOT NULL` 조건 유지
* `test(company)` CompanySearch 하이브리드 fallback 단위 테스트 추가 (FULLTEXT 성공/0건 fallback/예외 fallback/H2 LIKE 경로)
* `chore(db)` companies 이름 검색용 FULLTEXT 인덱스 Flyway V25 추가(MySQL), H2는 no-op 마이그레이션 반영
* `refactor(post)` 게시글 사용자 API REST 경로 정규화 1차: 신 경로(`/api/posts?categoryName=...`, `/api/posts/{postId}`, `POST /api/posts`) 추가 및 구 경로 하위호환 유지
* `refactor(post)` `PostService`에 postId 기준 조회/수정/삭제 메서드(`getById`, `updateById`, `deleteById`) 추가
* `test(post)` `PostControllerIntegrationTest`에 신 경로 생성/목록/수정/삭제 테스트 4건 추가 및 통과
* `refactor(controller)` Company/AI/News/Report/File/Watchlist 컨트롤러에 REST 신 경로를 추가하고 구 경로 하위호환을 병행 지원
* `test(controller)` `CompanySearchControllerTest`, `CompanyOverviewTempControllerTest`, `CompanyAiControllerTest`, `FileDownloadControllerTest`, `CompanyWatchlistControllerTest`에서 신 경로 회귀 검증 통과
* `refactor(security)` `SecurityConfig` 매처를 공개/인증/USER 그룹 상수로 정리하고 신/구 URI를 동시 허용하도록 재배치
* `test(security)` `SecurityEndpointAuthorizationTest`로 공개 검색 permitAll, 사용자 경로 인증/인가, ADMIN 경로 USER 차단(403) 회귀 검증 통과
* `docs(api)` `docs/rest-endpoint-migration-2026-02.md`에 엔드포인트 Old->New 매핑 및 하위호환 정책 추가

### 2026-02-08

* `fix(company)` CompanyOverview ID/종목코드 해석 우선순위 보정
* `fix(report)` 보고서/지표 컨트롤러 재활성화 및 보안 경로 복구
* `fix(watchlist)` 워치리스트 비동기 캐시 처리에서 read-only 쓰기 오류 방지
* `feat(watchlist)` 워치리스트 등록 후 기업 개요 캐시를 비동기로 선행 적재(@EnableAsync + 이벤트 기반)
* `fix(auth)` @CurrentUser Long 주입을 userId 클레임 기반으로 지원하고 watchlist 컨트롤러 테스트 보정
* `feat(company)` 워치리스트 기업 목록 조회 API(`/api/companies`) 추가 및 CompanyInfo 응답/테스트 통과
* `feat(qna)` implemented QnA admin reply API (`/api/admin/posts/qna/{postId}/replies`) and dynamic `qnaStatus` ("pending"/"answered") logic in `PostMapper`.
* `refactor(post/comment)` PostResponse/CommentResponse author field transition from userId(Long) to name(String) and verification completed.

### 2026-02-09

* `fix(watchlist)` 워치리스트 소프트 삭제 후 동일 기업 재등록 시 중복 오류가 발생하지 않도록 활성 항목만 중복 체크하고, 삭제 이력은 restore+note 갱신으로 복구 처리
* `fix(company)` CompanyInfo reputationScore 응답을 100배 스케일링하고 소수 0자리 반올림 적용
* `feat(news)` 관리자 최신 뉴스 재수집 API(`/api/admin/companies/{stockCode}/news/refresh-latest`) 추가 및 `average_score` 누락 시 기사 점수 평균 복구 로직/테스트 반영
* `fix(news)` 최신 뉴스 재수집 API 권한을 ROLE_USER로 조정하고 경로를 `/api/companies/{stockCode}/news/refresh-latest`로 변경
* `feat(company)` AI 종합 코멘트 캐시 연동: `/api/v1/analysis/{company_code}/ai-comment` 클라이언트/서비스 추가, `company_key_metrics.ai_comment` 저장, 워치리스트 등록 시 선행 적재, 관리자 수동 캐시 API(`/api/admin/companies/{companyId}/ai-comment/cache`, `/api/admin/companies/ai-comment/cache`) 및 테스트 추가
* `fix(news)` 최신 뉴스 재수집 API 실행 후 `company_key_metrics.external_health_score`를 최신 분기로 즉시 동기화하도록 연결
* `feat(insight)` 인사이트 조회 API에 `refresh` 파라미터를 추가하고 refresh=true 시 뉴스/사업보고서 강제 재수집 및 `external_health_score` 동기화 반영

### 2026-02-08

* `fix(company)` CompanyOverview에서 종목코드 입력을 기업 ID로 해석하도록 보정
* `fix(company)` CompanyInfo overallScore를 composite_score로 매핑
* `feat(company)` CompanyOverview 신호등 캐시(AI signals) 연동 및 테스트 추가
* `fix(company)` CompanyOverview metrics level에 ACTUAL signal_color 반영
* `feat(company)` CompanyOverview 건강점수 캐시 연동 및 테스트 통과
* `feat(company)` CompanyOverview에 예측 캐시 연동 및 테스트 정합화
* `feat(company)` CompanyOverview 예측 캐시 서비스 추가 및 테스트 통과
* `fix(company)` CompanyOverview에서 quarterKey 미지정 시 ACTUAL 최신 분기를 기본값으로 사용
* `feat(post)` 게시글 상세 응답에 첨부파일 목록과 다운로드 정보 포함
* `fix(file)` 게시글 첨부파일 다운로드 권한을 로그인 사용자 전체로 완화하고 서비스 테스트 보강
* `feat(company)` CompanyOverview 임시 컨트롤러 추가 및 테스트 통과
* `fix(company)` 6자리 분기키 입력 정규화 및 CompanyInfoService 테스트 추가
* `fix(company)` CompanySectorService 트랜잭션 추가로 LazyInitialization 방지
* `fix(company)` 개요 지표 최신 버전 조회 시 위험/비위험 지표 최신 버전 병합 조회
* `fix(company)` CompanyOverview metricSeries 범위/데이터 소스 조정 및 metrics 다음 분기 PREDICTED+signal_color 매핑
* `feat(company)` 인사이트 기반 외부 건강도 동기화 및 CompanyInfo 평판 점수 폴백 적용
* `feat(insight)` 기업 인사이트 응답에 평균 점수(averageScore) 포함
* `feat(company)` CompanyOverviewService 추가 및 테스트 통과
* `feat(company)` CompanyOverview DTO/하위 DTO 및 테스트 추가
* `feat(metric)` 키 메트릭 엔티티/리포지토리 추가 및 H2 스키마 정합화, 리포지토리 테스트 통과
* `feat(metric)` key_metric_descriptions 시드 마이그레이션 추가 (MySQL/H2)
* `feat(company)` CompanySectorService 추가 및 테스트
* `feat(company)` CompanySectorDto 추가
* `feat(company)` CompanyInfoDto 추가 및 테스트
* `feat(company)` CompanyInfoDto id/stockCode 필드 변경
* `feat(company)` CompanyInfoService 추가 및 테스트
* `fix(metric)` company_key_metrics ai_comment 타입 정합화
* `fix(metric)` key_metric_descriptions/metric_descriptions 텍스트 타입 정합화(H2 포함)

### 2026-02-06

* `fix(test)` test 프로필 Flyway 활성화 및 H2 마이그레이션 정합화(중복 V16 정리, report_contents summary 타입 TEXT 보정) 후 `./gradlew test` 통과
* `feat(post)` 보드 기반 게시글 시스템 리팩토링 완료: `/api/posts/{categoryName}` 경로 적용, 관리자 API(`AdminPostController`) 분리, `PostService` 통합 로직 구현 및 관련 테스트 27건 통과 #70
* `fix(insight)` 인사이트 폴링 시 첫 응답 빈 배열 문제 해결: CompanyInsightService.getInsights @Transactional 제거 및 컨트롤러 테스트 통과
* `fix(insight)` 인사이트 폴링 시 첫 응답 빈 배열 문제 해결: CompanyInsightService.getInsights @Transactional 제거 및 컨트롤러 테스트 통과
* `fix(report)` PDF/지표 입력 분리 및 미발행 버전 재사용 로직 적용(수동/엑셀/예측 모두), `/api/admin/reports/metrics` JSON 수동 적재 엔드포인트 및 콘솔 갱신, 관련 테스트 통과
* `fix(report)` 최신 지표 조회 시 ACTUAL/PREDICTED가 있는 최신 버전으로 조회하도록 보정 및 관련 테스트 통과
* `fix(watchlist)` 최신 버전 조회에서 published 조건 제거 및 관련 테스트 통과
* `fix(report)` PDF/지표 입력 분리 및 미발행 버전 재사용 로직 적용(수동/엑셀/예측 모두), `/api/admin/reports/metrics` JSON 수동 적재 엔드포인트 및 콘솔 갱신, 관련 테스트 통과
* `fix(report)` 최신 지표 조회 시 ACTUAL/PREDICTED가 있는 최신 버전으로 조회하도록 보정 및 관련 테스트 통과
* `fix(watchlist)` 최신 버전 조회에서 published 조건 제거 및 관련 테스트 통과
* `test(watchlist)` 워치리스트 등록 API 컨트롤러 테스트 추가 및 통과
* `feat(watchlist)` 워치리스트 분기별 지표 값(ACTUAL, 최신 발행 버전) 조회 서비스/DTO/쿼리 추가 및 테스트 통과
* `feat(watchlist)` 워치리스트 지표 값 조회 API/보안 경로/컨트롤러 테스트 추가 및 통과
* `feat(watchlist)` 워치리스트 지표 값 범위 조회(분기 그룹) 서비스/쿼리 추가 및 테스트 통과
* `feat(watchlist)` 워치리스트 지표 값 범위 조회 API 파라미터 지원 및 컨트롤러 테스트 통과
* `feat(watchlist)` 워치리스트 분기별 지표 값(ACTUAL, 최신 발행 버전) 조회 서비스/DTO/쿼리 추가 및 테스트 통과
* `feat(watchlist)` 워치리스트 지표 값 조회 API/보안 경로/컨트롤러 테스트 추가 및 통과
* `feat(watchlist)` 워치리스트 지표 값 범위 조회(분기 그룹) 서비스/쿼리 추가 및 테스트 통과
* `feat(watchlist)` 워치리스트 지표 값 범위 조회 API 파라미터 지원 및 컨트롤러 테스트 통과

### 2026-02-07

* `chore(build)` spring-boot-devtools 의존성 추가
* `fix(swagger)` @CurrentUser 파라미터 숨김 및 파일 업로드 multipart/form-data 적용

### 2026-02-05

* `feat(report)` 보고서 PDF 단독 업로드 서비스 추가(기업 미존재 시 스킵) 및 테스트 통과
* `feat(report)` 보고서 PDF 단독 업로드 API(`/api/admin/reports/pdf`) 추가 및 테스트 통과
* `feat(watchlist)` 워치리스트 기업 집합 기준 분기별 비위험 지표 평균 조회 API(`/api/watchlists/metric-averages`) 추가 (ACTUAL + 최신 발행 버전 기준), 보안 규칙/Swagger 반영 및 관련 테스트·전체 테스트 통과
* `fix(news)` AI 뉴스 datetime 포맷 혼재(오프셋 포함/미포함) 대응: 응답 DTO는 문자열로 수신하고 서비스에서 유연 파싱(OffsetDateTime 우선, LocalDateTime fallback) 적용
* `fix(news)` AI 뉴스 응답의 무오프셋 datetime(`yyyy-MM-dd'T'HH:mm:ss.SSSSSS`) 파싱 실패 대응: DTO를 LocalDateTime으로 조정하고 NewsClient 디코딩 예외 메시지를 원인별로 분리
* `docs(news)` NewsController Swagger 문서 보강(bearerAuth, 200/401/404 응답 명세)
* `feat(company)` companies에 industry_codes 외래키를 연결하는 마이그레이션 추가 (V15, MySQL/H2) - `industry_code_id` 컬럼/인덱스/FK(`ON DELETE SET NULL`)
* `fix(watchlist)` 위시리스트 중복 등록 정책을 restore에서 충돌 반환으로 변경하고 `WATCHLIST_DUPLICATE`(409, '중복저장입니다.') 에러 코드 추가
* `test(watchlist)` 중복 등록 시 watchlist 전용 에러 코드 반환 검증 테스트 추가

### 2026-02-05

* `feat(metric)` 저장된 전체 분기를 순회해 `metric_averages`를 계산/저장하는 `MetricAverageBatchService` 추가
* `test(metric)` 전체 분기 순회 배치 실행 시 분기별 평균 저장을 검증하는 테스트 추가

### 2026-02-05

* `feat(risk)` 모든 기업-분기의 최신 보고서 버전을 대상으로 `risk_score_summaries`를 배치 계산/저장하는 `RiskScoreBatchService` 추가 (페이지 처리)
* `test(risk)` 배치 저장 결과에서 최신 버전 선택 및 `risk_level`(DANGER/CAUTION) 저장 검증 테스트 추가

### 2026-02-05

* `feat(qna)` Q&A API 사용자/관리자 분리 구현, 동적 상태(pending/answered) 계산 적용 및 통합 테스트 완료 (스키마 변경 없음) #63

* `chore(db)` 산업 코드 관련 마이그레이션(V8, V9)을 V1__init.sql로 통합 (버전 충돌 방지)
* `feat(qna)` Q&A API 사용자/관리자 분리 구현, 동적 상태(pending/answered) 계산 적용 및 통합 테스트 완료 (스키마 변경 없음) #63

### 2026-02-04

* `feat(industry)` 산업 코드 엔티티/리포지토리 추가 및 마이그레이션(V8) 초안 반영
* `fix(industry)` industry_name NULL 허용 반영 (V8)
* `feat(industry)` 업종 코드 시딩 마이그레이션(V9) 추가
* `test(industry)` 업종 리포지토리 조회 및 NULL 허용 테스트 추가
* `docs(erd)` industry_codes 관계 반영

### 2026-02-05

* `fix(swagger)` OpenAPI 서버 URL을 절대 URL 주입 방식에서 상대 경로(`/`) 고정으로 변경하여 HTTPS 환경의 Mixed Content/CORS 이슈를 예방
* `test(swagger)` `OpenApiConfigTest` 추가로 OpenAPI servers 값이 `/`로 유지되는지 단위 테스트 검증
* `test` `./gradlew test` 전체 테스트 통과
* `feat(metric)` metrics 테이블에 `is_risk_indicator` 컬럼 추가(MySQL/H2 Flyway V8) 및 `MetricsEntity` 매핑 반영
* `test(metric)` 시드 기본값(false)과 컬럼 미지정 INSERT 시 DB 기본값(0) 저장을 검증하는 저장소 테스트 2건 추가
* `feat(risk)` `risk_score_summaries` 테이블(Flyway V9, MySQL/H2)과 위험도 집계 도메인/서비스 추가 (`is_risk_indicator=1` + `ACTUAL` 기준)
* `test(risk)` 위험도 계산 서비스 테스트 추가(집계 성공/집계 대상 없음 UNDEFINED) 및 `./gradlew test` 전체 통과
* `feat(metric)` `metric_averages` 테이블(Flyway V10, MySQL/H2)과 분기별 비위험 지표 통계 집계 서비스 추가 (`is_risk_indicator=0` + `ACTUAL` + 최신 버전 기준)
* `test(metric)` 비위험 지표 통계 집계 테스트 추가(최신 버전 반영, PREDICTED/위험 지표 제외) 및 `./gradlew test` 전체 통과
* `feat(watchlist)` `company_watchlists` 테이블(Flyway V11)과 watchlist 등록/삭제/대시보드 API 추가, 비위험 지표는 최신 발행 버전+ACTUAL+시장 평균 조합으로 조회
* `refactor(user)` users의 `company_id` 제거(Flyway V12) 및 `UserEntity`/보안 경로 업데이트, watchlist 대시보드 서비스 테스트 추가 후 `./gradlew test` 전체 통과

### 2026-02-04

* `feat(company)` CompanyAiService 조회용 API(`/api/companies/{companyCode}/ai-analysis`) 추가 및 ROLE_USER 보안 규칙 반영, 컨트롤러 테스트 통과
* `feat(company)` AI 리포트 PDF 생성/저장 API(`/api/companies/{companyCode}/ai-report`) 추가 및 ROLE_ADMIN 보안 규칙 반영, 컨트롤러 테스트 통과
* `feat(dev)` API 콘솔에 기업 AI 분석 조회 섹션 추가 및 기업 검색 경로(`/api/companies/search`) 정합화, 콘솔 뷰 테스트 통과
* `feat(dev)` API 콘솔에 기업 AI 리포트 PDF 생성/저장 테스트 섹션 추가
* `feat(dev)` API 콘솔 기업 AI 분석 섹션에 기업명 검색/선택 UX 보강(디바운스 검색) 및 `SPRING_PROFILES_ACTIVE=test` 기준 전체 테스트 통과
* `fix(company)` AI 서버 예측 응답 DTO(`AiAnalysisResponse`) 누락 추가 및 `ai.server.url` 설정 추가, 전체 테스트 통과
* `fix(dev)` dev 콘솔 템플릿들의 API 호출 경로를 실제 `/api/*` 컨트롤러 매핑과 정합화, 전체 테스트 통과

### 2026-02-02

* `fix(test/security)` 보고서 파일 URL 조회 테스트 경로(`/api`) 정합화 및 `/api/reports/files/*/url` ROLE_USER 보안 규칙 추가, 전체 테스트(183개) 통과
* `refactor(web)` 모든 컨트롤러 엔드포인트에 `/api` 접두사 적용 및 보안 설정 동기화
* `refactor(auth)` 회원가입 DTO (`SignupRequest`) 필드명 수정 (`username` -> `name`) 및 관련 서비스 수정
* `test(integration)` API 경로 및 DTO 변경에 따른 통합 테스트 코드 수정 및 정상화 (전체 177개 통과)
* `refactor(security)` 기업 검색 API 경로를 `/companies/search`로 이동하고 ROLE_USER 전용 보안 규칙 적용
* `test(company)` 기업 검색 API 인증/권한(401/403/200) 통합 테스트 추가
* `refactor(security)` 보고서 지표 조회 API 경로를 `/reports/metrics/*`로 이동하고 ROLE_USER 전용 보안 규칙 적용
* `test(report)` 보고서 지표 조회 API 인증/권한(401/403/200) 통합 테스트 추가
* `refactor(security)` 보고서 PDF 다운로드 경로를 `/reports/files/{id}`로 이동하고 ROLE_USER 전용 보안 규칙/다운로드 URL 경로 반영
* `test(report)` 보고서 PDF 다운로드 API 인증/권한(401/403/302) 통합 테스트 추가
* `feat(auth)` 이메일 인증 리다이렉트 상태코드 매핑 및 returnUrl 화이트리스트 검증 추가
* `test(auth)` 이메일 인증 리다이렉트/returnUrl 검증 WebMvc 테스트 보강
* `feat(auth)` 이메일 인증 결과 DTO 추가 및 redirect=false JSON 응답 정비

### 2026-02-02

* `feat(auth)` 이메일 인증 리다이렉트 상태코드 매핑 및 returnUrl 화이트리스트 검증 추가
* `test(auth)` 이메일 인증 리다이렉트/returnUrl 검증 WebMvc 테스트 보강
* `feat(auth)` 이메일 인증 결과 DTO 추가 및 redirect=false JSON 응답 정비

### 2026-01-30

* `fix(dev)` 예측 보고서 콘솔 토큰 로딩 수정
* `fix(security)` 예측 보고서 콘솔 경로 접근 허용
* `feat(dev)` 예측 보고서 조회 콘솔 페이지 추가
* `feat(report)` 최신 예측값 조회 API/보고서 PDF 다운로드 추가
* `feat(report)` 최신 예측값 조회 로직/테스트 추가
* `feat(dev)` API 콘솔 보고서 발행 테스트 폼 추가
* `feat(report)` 보고서 지표+PDF 발행 API/테스트 추가
* `feat(report)` 보고서 지표+PDF 발행 서비스/테스트 추가
* `feat(dev)` API 콘솔 예측값 적재 UI 추가
* `feat(dev)` API 콘솔 기업 검색 결과 디바운싱 리스트 표시
* `feat(report)` 보고서 지표 예측값 적재 API/테스트 추가
* `feat(report)` 보고서 지표 예측값 적재 서비스/DTO 및 테스트 추가
* `fix(report)` 기업코드 정규화 로직 보완(비숫자 포함도 6자리 미만이면 좌측 패딩)
* `chore(logging)` 비동기 콘솔/파일 로깅 및 롤링 정책 설정
* `feat(report)` 보고서 지표 최신 버전 조회 리포지토리/테스트 추가
* `feat(report)` 보고서 지표 조회 서비스/DTO 및 테스트 추가
* `feat(report)` 보고서 지표 분기별 그룹핑 응답 추가
* `feat(report)` 보고서 지표 그룹 조회 API/문서/테스트 추가
* `feat(dev)` API 콘솔에 보고서 지표 그룹 조회 버튼 추가
* `feat(company)` 기업명 검색 서비스/레포지토리 및 테스트 추가
* `feat(company)` 기업 검색 API/문서/콘솔 연동 추가
* `fix(auth)` Auth Console 로그아웃 버튼 동작 보강
* `test(auth)` 로그아웃 테스트 Role 중복 저장 보정
* `fix(auth)` 로그아웃 전체 처리 토큰 검증(AccessTokenValidator) 반영 및 테스트 추가
* `fix(auth)` 단일 로그아웃 Access 토큰 블랙리스트 및 로그아웃 테스트 보강
* `feat(auth)` Auth Console 보호 API UX 개선
* `fix(test)` 테스트 프로파일 정리 및 엑셀 파서 테스트 메모리 워크북 전환
* `chore(build)` spring-batch-core 의존성 명시 추가
* `refactor(dto)` DTO MapStruct 전환 및 매퍼 주석 보강
* `refactor(company)` DART 동기화 응답 매핑 MapStruct 적용
* `refactor(report)` 보고서 그룹/예측 응답 MapStruct 매핑 추가
* `chore(config)` dev 전용 SQL 로그/Turnstile 기본값 분리
* `chore(config)` dev/prod DB 환경변수 체계 통일
* `docs(config)` env 예시/운영 env 템플릿 정합화
* `chore(config)` prod 이메일 인증 skip=false 유지 및 dev 설정 복구
* `chore(config)` prod 이메일 설정 import 추가
* `docs(config)` .env.example 환경변수 목록 정리
* `docs(config)` README 환경변수 요약 추가

### 2026-01-31

* `chore(deploy)` prod 프로필에서 Redis만 docker compose로 실행
* `chore(config)` prod 파일 업로드 크기 바인딩 분리(FILE_MAX_SIZE_BYTES)
* `feat(file)` files storage_key 컬럼 추가 및 저장 메타데이터 보강
* `feat(file)` S3 presigned 다운로드 리졸버 추가
* `test(file)` 다운로드 presigned 리다이렉트 통합 테스트 추가
* `fix(security)` actuator health 접근 허용
* `test(security)` 헬스체크 접근 테스트 추가
* `chore(auth)` 리프레시 토큰 쿠키 SameSite/secure 설정 분리

### 2026-02-01

* `fix(security)` 공개 경로 축소 및 로그아웃 인증 요구 반영
* `feat(auth)` 이메일 인증 리다이렉트 옵션 추가
* `chore(dev)` 인증 콘솔 경로 /dev/*로 정리 및 템플릿 링크 갱신
* `refactor(dev)` 인증 콘솔 컨트롤러 DevConsoleController로 통합
* `refactor(dev)` dev 카테고리 API를 DevConsoleController로 통합
* `fix(web)` favicon 요청 처리 추가
* `feat(file)` 파일 다운로드 URL 조회 API(/files/{id}/url) 및 테스트 추가
* `feat(category)` 카테고리 조회 API(/categories) 추가 및 테스트 보강
* `fix(security)` 카테고리 조회 공개 경로 허용
* `chore(config)` CORS 허용 도메인 외부화(프로파일별)
* `chore(prod)` actuator/health 안정화 및 swagger 비활성화
* `fix(db)` H2 storage_key 마이그레이션 추가
* `fix(test)` test 프로파일 Turnstile secret-key 기본값 추가
* `chore(deploy)` prod compose에서 mysql 비활성화

### 2026-01-29

* `feat(report)` 보고서 지표 적재 로그 보강
* `docs(report)` 보고서 지표 업로드 문서 추가
* `feat(dev)` API 콘솔에 보고서 지표 업로드 버튼 추가
* `feat(report)` 보고서 지표 업로드 관리자 API 추가
* `feat(report)` 엑셀 지표 파서 및 테스트 추가
* `feat(report)` 보고서 지표 적재 서비스 및 테스트 추가
* `feat(report)` 분기 계산 유틸 및 보고서 관련 리포지토리 추가
* `chore(dart)` DART 응답 버퍼 상향 및 설정 외부화
* `feat(dev)` API 콘솔에 DART 동기화 실행 버튼 추가
* `feat(auth)` dev 관리자 회원가입 옵션 추가
* `fix(company)` 기업 동기화 JDBC 조회 컴파일 오류 수정
* `docs` DART 기업 동기화 운영 가이드 보강
* `test(company)` DART 기업 동기화 Reader/Processor 테스트 추가
* `chore(batch)` DART 배치 운영 설정(타임아웃/재시도/이력 테이블) 추가
* `feat(company)` DART 기업 동기화 수동 실행 API 및 스케줄러 토글 구성
* `feat(company)` DART 기업 동기화 Reader/Writer 및 JDBC 업서트 로직 추가
* `chore(batch)` DART 기업 동기화 배치 스캐폴딩 추가
* `docs` DART 기업 목록 동기화 요구사항 문서 추가
* `chore(dev/db)` dev datasource를 MySQL로 전환 및 docker compose에 mysql 서비스 추가
* `chore(db)` H2 마이그레이션 경로 분리(db/migration-h2) 및 테스트 설정/문서 경로 갱신
* `chore(db)` metrics 시드 마이그레이션 추가(V5, UPSERT)

### 2026-01-29
* `feat(auth)` 로그인 API 정렬 (`AuthLoginResponse` 도입, 응답에 `UserSummaryDto` 포함)
* `feat(auth)` 회원가입 API 정렬 (`SignupRequest` phone 필드 삭제, username 필드 재정의)
* `feat(auth)` 로그아웃(`POST /auth/logout`) 및 전체 로그아웃(`POST /auth/logout-all`) 구현
* `feat(auth)` Refresh Token을 HttpOnly 쿠키로 전달하도록 변경 및 통합 테스트 반영

### 2026-01-28

* `feat(auth)` 비밀번호 만료 정책(90일) 및 비밀번호 변경 API (`POST /auth/change-password`) 구현
* `feat(user)` UserEntity에 `password_changed_at` 추가 및 마이그레이션(V4)
* `test(auth)` 비밀번호 변경 및 만료 체크 테스트 추가
* `chore(db)` Flyway 도입 및 V1 초기 스키마 마이그레이션 추가 (ddl-auto: validate 전환)
* `refactor(auth/file/post)` ROLE_ 통일, refresh_tokens 스키마 정합화, files/post_files 분리, post_view_counts 도입
* `feat(domain)` companies/quarters/metrics/company_reports 관련 엔티티 스캐폴딩 추가
* `test` CommentIntegrationTest 카테고리 중복 회피 및 EmailVerificationServiceTest TestSecurityConfig 적용
* `chore(db)` H2 전용 Flyway 스키마 추가 및 dev/test DB URL/Flyway 경로 정리, CompaniesEntity CHAR 컬럼 정합
* `test` Auth/File 통합 테스트에서 session 키/파일 매핑 기준 반영 및 보안 테스트 설정 정합
* `fix` UserRoleRepository 컴파일 오류(잘못된 \t 문자) 수정
* `docs` ERD.md 추가 및 README에 스키마 안내 섹션 추가
* `chore(dev)` Auth Console에서 로그아웃 API 미구현 시 안내/비활성화 처리
* `refactor(audit)` BaseEntity에 createdBy/updatedBy 통합, SecurityAuditorAware 추가 및 userId 클레임/관련 엔티티·테스트 정리

### 2026-01-27

* `chore(security)` CSP Report-Only 헤더 추가 및 정적 리소스 허용 경로 보강
* `feat(dev)` Turnstile 검증 디버그 로그 강화 및 dev 디버그 활성화
* `feat(dev)` Turnstile 콘솔 페이지 추가 및 검증 API 연동
* `feat(dev)` Auth 콘솔 회원가입 폼에 Turnstile 위젯/토큰 입력 추가
* `chore(config)` dev 환경 Turnstile 기본 키 제거 (환경 변수 필수)
* `test(auth)` SignupRequestTest에 Turnstile 토큰 기본값 추가
* `test(auth)` Turnstile 실패 통합 테스트 제거 및 주석 정리

### 2026-01-28

* `docs(swagger)` SENTINEL PoC OpenAPI 스펙 정적 제공 및 Swagger UI 다중 문서 등록

### 2026-01-26

* `chore(build)` CodeBuild gradlew 실행 권한 보정 (buildspec)
* `feat(dev)` dev 홈 페이지 추가 및 루트 접근 허용
* `chore(deploy)` CodeDeploy 실행 커맨드 dev 고정/nohup 옵션 적용
* `chore(deploy)` CodeDeploy 재시작 안정화 (stop/start 스크립트 보강)

### 2026-01-25

* `feat(swagger)` 핵심 DTO Swagger 스키마 추가
* `feat(swagger)` 파일 DTO Swagger 스키마 추가
* `feat(swagger)` 핵심 컨트롤러 Swagger 문서화 (Auth/Post/Comment)
* `feat(swagger)` Swagger 보안/공개 엔드포인트 정리
* `feat(swagger)` 파일 컨트롤러 Swagger 문서화
* `feat(swagger)` 개발/콘솔 및 이메일 인증 API 문서화
* `feat(swagger)` 에러 응답 Swagger 스키마 추가
* `feat(swagger)` API 예외 응답 문서화 (공통 오류 코드)
* `feat(swagger)` Swagger UI 커스텀 테마 적용
* `feat(swagger)` Swagger API 버전 설정 추가
* `feat(swagger)` Swagger 공개 경로 보안 허용
* `feat(swagger)` OpenAPI 기본 설정 및 springdoc 설정 추가
* `chore(deps)` SpringDoc 버전 업데이트 (2.3.0 -> 2.6.0)
* `chore(deps)` SpringDoc 버전 업데이트 (2.6.0 -> 2.8.15)
* `test(file)` test 프로파일 파일 스토리지 스텁 설정 추가

### 2026-01-23

* `feat(file)` 파일 조회/다운로드 API 및 콘솔 목록 기능 추가
* `feat(dev)` 파일 업로드 콘솔 페이지 추가
* `test(file)` 파일 업로드 통합/설정 테스트 추가
* `test(file)` 파일 업로드 검증/스토리지 단위 테스트 추가
* `feat(file)` 파일 업로드 커스텀 에러코드/예외 추가
* `feat(file)` 전역 파일 업로드 설정 및 검증기 추가
* `feat(file)` 파일 업로드 기본 구성 추가 (저장소/서비스/컨트롤러/설정/마이그레이션)
* `feat(file)` files 엔티티 추가
* `refactor(service)` Post/Comment 서비스에 UserEntity/ID 전달로 중복 조회 제거
* `feat(security)` @CurrentUser 리졸버 추가 및 Post/Comment 컨트롤러 적용
* `test(config)` 테스트용 JavaMailSender 모킹 빈 추가
* `chore(config)` dev 프로파일에서 application-email.yml import 추가
* `feat(auth)` 이메일 인증 컨트롤러/서비스 및 회원가입 연동 추가
* `feat(user)` 이메일 인증 엔티티/리포지토리/마이그레이션 추가
* `chore(config)` 메일 스타터/메일 설정 파일 추가
* `test(user)` 이메일 인증 서비스 테스트 추가
* `refactor(auth)` dev 환경 회원가입 시 이메일 인증 스킵 처리 및 테스트 보강
* `chore(dev)` Redis docker compose 파일 추가
* `chore(dev)` Redis compose 파일 docker-compose.yml로 통합
* `chore(dev)` docker compose dev/prod 오버라이드 파일 추가
* `chore(dev)` docker compose override 표준화 (override 추가, dev 파일 제거)
* `feat(auth)` 미인증 로그인 응답 분리 및 회원가입 이메일 발송 테스트 보강
* `feat(auth)` 이메일 인증 링크 base-url 설정 추가
* `chore(config)` prod 이메일 인증 base-url 설정 추가

### 2026-01-22

* `feat(posts)` 게시글 JWT 기반 컨트롤러 추가 및 subject(UUID) 검증 처리
* `feat(posts)` 게시글 목록 페이징 응답(PageRequest/PageResponse) 적용
* `test(posts)` 게시글 JWT 검증/페이징 통합 테스트 추가
* `test(service)` PostService/UserDomainService 단위 테스트 추가
* `test(auth)` AccessTokenBlacklistService 단위 테스트 추가
* `test(repo)` PostsRepository/CommentsRepository DataJpaTest 추가
* `feat(comment)` 댓글 CRUD 컨트롤러 추가 및 JWT 기반 처리
* `test(comment)` 댓글 CRUD 컨트롤러 통합 테스트 추가
* `refactor(error)` CommonException 전역 처리 추가

### 2026-01-21

* `test(auth)` 로그인 **통합 테스트** 추가 (Redis Testcontainers)
* `test(auth)` AuthService **실패 케이스 단위 테스트**
* `test(security)` 테스트용 `TestSecurityConfig` 추가 및 JWT 키 파일 의존 제거
* `chore(test)` Testcontainers 의존성 최소화
* `refactor(error)` 전역 예외 처리 통합

    * 공통 에러 코드
    * GlobalExceptionHandler
* `feat(domain)` tags / post_tags ERD & 엔티티 / 테스트 추가
* `test` posts/likes/categories/tag 엔티티 테스트를 DataJpaTest로 전환 (JWT 키 의존성 회피)
* `docs` AGENTS 영어 예외 규칙 확장 (개인 로그 선호 반영)
* `test` posts 연관관계 매핑 및 엔티티 테스트 추가
* `test(posts)` User 게시글 CRUD 컨트롤러 통합 테스트 추가
* `test` Tag/PostTags 엔티티 테스트 SpringBootTest 전환 및 TestSecurityConfig 적용
* `test` post 엔티티 테스트 패키지 정리

### 2026-01-20

* `feat(auth)` **JWT 인증 Phase 1 구성**
* `feat(auth)` 레거시 `ROLE_` 호환 및 컷오프 정책
* `test(auth)` JWT / Auth / RefreshToken 단위 테스트
* `feat(user)` User / Role 엔티티 및 보안 어댑터
* `feat(domain)` 게시글 / 카테고리 / 좋아요 엔티티 추가
* `chore` BigProject.sql 제거 및 추적 정책 정리
* `docs`

    * AGENTS.md 환경 정보
    * 영어 예외 규칙
    * 테스트/주석 가이드
    * 개인 로그 규칙 및 로그 파일 생성

### 2026-01-19

* `chore(config)` prod/dev YAML 분리
* `.env.example` 제공
* 설정/템플릿 변경 커밋

---

## 3. Next Steps (우선순위 기준)

### 1️⃣ ERD & 엔티티 인프라

1. ERD 기반 **키 / 제약 수기 확정**
2. 엔티티 공통 정책

    * ID 전략
    * Soft Delete 여부
    * Auditing 필드
3. 패키지 구조 확정 및 스캐폴딩

### 2️⃣ JWT Phase 3 (운영 고도화)

1. Access Token 갱신 UX 개선 (Silent Refresh)
2. 보안 모니터링 (이상 로그인 감지 등)

---

## 4. Known Issues / Pending

* ❗ **ERD SQL에 키/제약 정보 누락**
  → 수기 정의 필요
* ❗ **RS256 키 파일 준비 필요** (운영 환경)

---

## 5. History (요약 로그)

* **2026-02-08**

    * CompanyOverview ID/stockCode 해석 우선순위 보정
    * 보고서/지표 컨트롤러 재활성화 및 관련 테스트 통과

* **2026-02-07**
    * spring-boot-devtools 의존성 추가

* **2026-02-04**
    * 산업 코드 엔티티/스키마 반영, industry_name NULL 허용 및 업종 코드 시딩/테스트 추가

* **2026-02-04**
    * dev 콘솔 템플릿 API 경로(`/api/*`) 정합화
    * AI 서버 예측 응답 DTO(`AiAnalysisResponse`) 및 `ai.server.url` 설정 추가

* **2026-02-02**
    * API 엔드포인트 /api 접두사 표준화 및 SignupRequest DTO 필드명 수정
    * 전체 통합 테스트 정상화

* **2026-01-30**

* 기업코드 정규화 로직 보완(비숫자 포함도 6자리 미만이면 좌측 패딩)

* **2026-01-29**

    * 보고서 지표 적재 로직 및 API 추가
    * DART 기업 동기화 배치 고도화
    * dev 데이터소스 MySQL 전환

* **2026-01-28**

    * Flyway 도입 및 V1 초기 스키마 마이그레이션 추가
    * ROLE_ 통일, refresh_tokens/파일/조회수 분리 등 ERD 정합화 반영

* **2026-01-26**

    * CI/CD 안정화 (CodeBuild/CodeDeploy)

* **2026-01-25**

    * API Swagger 문서화 고도화

* **2026-01-23**

    * 파일 업로드/다운로드 인프라 구축
    * 이메일 인증 기능 추가
    * Redis 연동

* **2026-01-22**

    * 게시글/댓글 API 및 JWT 연동

* **2026-01-21**

    * 전역 예외 처리 및 통합 테스트 환경 구축
* **2026-01-20**

    * JWT Phase 1 완료
    * User/Role + 게시글 도메인 엔티티 구축
* **2026-01-19**

    * 환경 설정 분리 및 템플릿 정리

---

## 6. 작업 에이전트 워크플로우

1. 작업을 기능/변경 단위로 분리한다.
2. 단위 작업마다 코드 수정 → 관련 테스트 실행 → 커밋을 순서대로 수행한다.
3. 모든 단위 작업 완료 후, 전체 테스트(예: `./gradlew test`)를 한 번 더 실행한다.

---

## 7. Context7 MCP 사용법

### 기본 명령어
- **라이브러리 ID 확인**: `@context7 resolve-library-id <libraryName>`
- **문서 조회**: `@context7 query-docs <libraryId> <query>`

### 예시
```
@context7 resolve-library-id spring-boot
@context7 query-docs /springframework/spring-boot "JPA 설정 방법"
```

### 주요 라이브러리 ID
- Spring Boot: `/springframework/spring-boot`
- Spring Security: `/springframework/spring-security`
- JPA/Hibernate: `/hibernate/hibernate-orm`
- Redis: `/redis/redis`
- JWT: `/jwt/jjwt`
- Testcontainers: `/testcontainers/testcontainers-java`
- H2 Database: `/h2database/h2`
- Lombok: `/projectlombok/lombok`
- QueryDSL: `/querydsl/querydsl`
- Flyway: `/flyway/flyway`
