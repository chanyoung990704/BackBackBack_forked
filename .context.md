# Development Context (Integrated)

## 1. Current Goals (현재 목표)

### A. 도메인/엔티티 인프라

* [ ] **ERD 기반 키/제약 수기 확정**

    * PK/FK
    * Unique / Index
    * Cascade / Nullable 정책
* [ ] **신규 엔티티 인프라 준비**

    * 패키지 구조 확정
    * BaseEntity / Auditing 전략 정리
* [ ] **기본 스캐폴딩**

    * Repository / Test 기본 골격

### B. 인증/보안 (JWT Phase 2)

* [ ] **로그아웃 / 전체 로그아웃**
* [ ] **Access Token 블랙리스트**
* [ ] **Refresh Token Rotation + 동시성 제어**

    * Redis + Lua
* [ ] **refresh_tokens 테이블**

    * 스키마 정의
    * 마이그레이션
    * 테스트 추가

---

## 2. Recent Changes (최근 변경 사항)

### 2026-01-22

* `feat(posts)` 게시글 JWT 기반 컨트롤러 추가 및 subject(UUID) 검증 처리
* `feat(posts)` 게시글 목록 페이징 응답(PageRequest/PageResponse) 적용
* `test(posts)` 게시글 JWT 검증/페이징 통합 테스트 추가
* `refactor(error)` CommonException 전역 처리 추가

### 2026-01-21

* `test(auth)` 로그인 **통합 테스트** 추가 (Redis Testcontainers)
* `test(auth)` AuthService **실패 케이스 단위 테스트**
* `test(security)` 테스트용 `TestSecurityConfig` 추가 및 JWT 키 파일 의존 제거
* `chore(test)` Testcontainers 의존성 최소화
* `refactor(error)` 전역 예외 처리 통합

    * 공통 에러 코드
    * GlobalExceptionHandler
* `feat(domain)` tags / post_tags ERD & 엔티티 / 테스트 추가
* `test` posts/likes/categories/tag 엔티티 테스트를 DataJpaTest로 전환 (JWT 키 의존성 회피)
* `docs` AGENTS 영어 예외 규칙 확장 (개인 로그 선호 반영)
* `test` posts 연관관계 매핑 및 엔티티 테스트 추가
* `test(posts)` User 게시글 CRUD 컨트롤러 통합 테스트 추가
* `test` Tag/PostTags 엔티티 테스트 SpringBootTest 전환 및 TestSecurityConfig 적용
* `test` post 엔티티 테스트 패키지 정리

### 2026-01-20

* `feat(auth)` **JWT 인증 Phase 1 구성**
* `feat(auth)` 레거시 `ROLE_` 호환 및 컷오프 정책
* `test(auth)` JWT / Auth / RefreshToken 단위 테스트
* `feat(user)` User / Role 엔티티 및 보안 어댑터
* `feat(domain)` 게시글 / 카테고리 / 좋아요 엔티티 추가
* `chore` BigProject.sql 제거 및 추적 정책 정리
* `docs`

    * AGENTS.md 환경 정보
    * 영어 예외 규칙
    * 테스트/주석 가이드
    * 개인 로그 규칙 및 로그 파일 생성

### 2026-01-19

* `chore(config)` prod/dev YAML 분리
* `.env.example` 제공
* 설정/템플릿 변경 커밋

---

## 3. Next Steps (우선순위 기준)

### 1️⃣ ERD & 엔티티 인프라

1. ERD 기반 **키 / 제약 수기 확정**
2. 엔티티 공통 정책

    * ID 전략
    * Soft Delete 여부
    * Auditing 필드
3. 패키지 구조 확정 및 스캐폴딩

### 2️⃣ JWT Phase 2

1. 로그아웃 / 전체 로그아웃 API
2. Access Token 블랙리스트 (Redis)
3. Refresh Rotation

    * Lua 기반 동시성 제어
4. refresh_tokens 마이그레이션 + 테스트

---

## 4. Known Issues / Pending

* ❗ **ERD SQL에 키/제약 정보 누락**
  → 수기 정의 필요
* ❗ **refresh_tokens 테이블 미구현**
* ❗ **RS256 키 파일 준비 필요**
* ❗ **User 게시글 CRUD는 임시로 `X-User-Id` 헤더를 사용**
  → JWT/인증 적용 시 `CustomUserDetails` 기반으로 교체 필요 (JWT Phase 2 연계)

---

## 5. History (요약 로그)

* **2026-01-22**

    * 게시글 API 페이징 및 JWT 기반 컨트롤러 추가
    * 게시글 관련 통합 테스트 보강 및 CommonException 처리 추가

* **2026-01-21**

    * 인증 통합 테스트 및 전역 예외 처리 리팩터링 완료
    * 게시글 CRUD 컨트롤러 테스트 및 엔티티 테스트 설정 보완
* **2026-01-20**

    * JWT Phase 1 완료
    * User/Role + 게시글 도메인 엔티티 구축
    * 테스트/문서/로그 프로토콜 정비
* **2026-01-19**

    * 환경 설정 분리 및 템플릿 정리

---
